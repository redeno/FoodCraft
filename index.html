<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Food Craft - Legend Edition</title>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #f0f2f5);
            --text: var(--tg-theme-text-color, #222);
            --hint: var(--tg-theme-hint-color, #999);
            --sec-bg: var(--tg-theme-secondary-bg-color, #ffffff);
            --primary: #2196F3;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            
            /* Rarity Colors */
            --rarity-common: #9e9e9e;
            --rarity-uncommon: #4caf50;
            --rarity-rare: #2196f3;
            --rarity-epic: #9c27b0;
            --rarity-legendary: #ff9800;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { 
            background: var(--bg);
            color: var(--text);
            padding: 12px;
            padding-bottom: 90px;
            touch-action: manipulation;
            line-height: 1.4;
        }
        
        .header {
            background: var(--sec-bg);
            padding: 16px;
            border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .level-badge {
            background: var(--success);
            color: white;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
        }

        .coins-badge {
            background: #FFC107;
            color: #333;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            background: var(--sec-bg);
            padding: 6px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-tab {
            flex: 1;
            padding: 10px 4px;
            text-align: center;
            border-radius: 10px;
            background: transparent;
            border: none;
            color: var(--text);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
        }
        .nav-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title {
            font-size: 15px;
            font-weight: 700;
            margin: 15px 0 10px 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--hint);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .item-card {
            background: var(--sec-bg);
            border-radius: 16px;
            padding: 12px 6px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .item-card:active { transform: scale(0.92); }
        .item-card.locked { opacity: 0.4; filter: grayscale(0.8); cursor: not-allowed; }
        .item-card.selected { border-color: var(--primary); background: rgba(33, 150, 243, 0.04); }

        .item-emoji { font-size: 32px; margin-bottom: 6px; transition: transform 0.2s; }
        .item-card:hover .item-emoji { transform: scale(1.1); }
        .item-name { font-size: 12px; font-weight: 600; margin-bottom: 6px; color: var(--text); }
        .item-count { font-size: 11px; color: var(--primary); font-weight: 800; background: rgba(33, 150, 243, 0.1); padding: 3px 8px; border-radius: 12px; }
        .item-zero { color: var(--hint); background: rgba(0,0,0,0.05); }
        .item-price { color: var(--success); font-size: 13px; font-weight: 800; display: flex; align-items: center; gap: 2px; }
        .item-stock { font-size: 10px; color: var(--warning); font-weight: 600; margin-top: 4px; }

        .cauldron-area {
            background: linear-gradient(135deg, var(--sec-bg) 0%, #f9f9f9 100%);
            padding: 20px;
            border-radius: 22px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.02);
        }
        
        .cauldron-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px auto;
            max-width: 180px;
        }

        .c-slot {
            aspect-ratio: 1;
            border-radius: 14px;
            border: 2px dashed #d1d1d1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.2s;
        }
        .c-slot.filled {
            border: 2px solid var(--primary);
            background: white;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.15);
            animation: pop 0.2s ease-out;
        }
        @keyframes pop { 0% { transform: scale(0.8); } 100% { transform: scale(1); } }

        .btn-primary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(33, 150, 243, 0.25);
            transition: all 0.2s;
        }
        .btn-primary:active { transform: translateY(2px); box-shadow: 0 2px 5px rgba(33, 150, 243, 0.25); }
        .btn-primary:disabled { background: #d0d0d0; box-shadow: none; cursor: not-allowed; }

        .recipe-row {
            display: flex;
            align-items: center;
            background: var(--sec-bg);
            padding: 14px;
            border-radius: 18px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            gap: 15px;
            border: 2px solid transparent;
            transition: 0.2s;
        }
        .recipe-row.common { border-color: var(--rarity-common); }
        .recipe-row.uncommon { border-color: var(--rarity-uncommon); }
        .recipe-row.rare { border-color: var(--rarity-rare); }
        .recipe-row.epic { border-color: var(--rarity-epic); }
        .recipe-row.legendary { border-color: var(--rarity-legendary); box-shadow: 0 0 15px rgba(255, 152, 0, 0.2); }

        .recipe-result { font-size: 36px; width: 60px; text-align: center; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
        .recipe-info { flex: 1; }
        .recipe-name { font-weight: 800; font-size: 15px; color: var(--text); }
        .recipe-ings { font-size: 13px; color: var(--hint); margin-top: 4px; font-weight: 500; }
        .recipe-hint { color: var(--primary); font-size: 12px; font-weight: 600; margin-top: 4px; }
        
        .rarity-label {
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 6px;
            margin-bottom: 4px;
            display: inline-block;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: var(--sec-bg);
            border-radius: 24px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .modal-title { font-size: 20px; font-weight: 800; margin-bottom: 15px; color: var(--primary); text-align: center; }
        .guide-text { font-size: 14px; color: var(--text); margin-bottom: 12px; }
        .guide-item { margin-bottom: 15px; padding-left: 10px; border-left: 3px solid var(--primary); }
        .guide-label { font-weight: 700; font-size: 13px; display: block; margin-bottom: 4px; color: var(--primary); }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 14px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            z-index: 3000;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        .timer { font-family: 'JetBrains Mono', monospace; font-size: 13px; background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 10px; color: var(--danger); font-weight: 700; }
        .help-btn { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 25px; background: var(--primary); color: white; border: none; font-size: 24px; font-weight: bold; box-shadow: 0 4px 15px rgba(33,150,243,0.4); z-index: 500; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div>üç≥ Food Craft</div>
        <div style="display: flex; gap: 8px;">
            <div class="level-badge">Lvl <span id="ui-level">1</span></div>
            <div class="coins-badge">ü™ô <span id="ui-coins">100</span></div>
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('craft')">ü•£ –ö–æ—Ç—ë–ª</button>
        <button class="nav-tab" onclick="switchTab('shop')">üõí –õ–∞–≤–∫–∞</button>
        <button class="nav-tab" onclick="switchTab('recipes')">üìã –ö–Ω–∏–≥–∞</button>
    </div>

    <div id="tab-craft" class="tab-content active">
        <div class="cauldron-area">
            <div class="section-title" style="justify-content: center; margin-top: 0;">–í–∞—Ä–µ–≤–æ (–¥–æ 9 –∏–Ω–≥—Ä.)</div>
            <div class="cauldron-slots" id="cauldron"></div>
            <button id="btn-craft" class="btn-primary" onclick="doCraft()" disabled>–ù–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤–∫—É</button>
        </div>

        <div class="section-title">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</div>
        <div class="grid" id="inventory-grid"></div>
    </div>

    <div id="tab-shop" class="tab-content">
        <div class="section-title">
            <span>–ü–æ–∫—É–ø–∫–∞</span>
            <span class="timer" id="shop-timer">15:00</span>
        </div>
        <div class="grid" id="shop-grid" style="margin-bottom: 25px;"></div>
        
        <div class="section-title">–°–±—ã—Ç –≥–æ—Ç–æ–≤—ã—Ö –±–ª—é–¥</div>
        <div class="grid" id="sell-grid"></div>
    </div>

    <div id="tab-recipes" class="tab-content">
        <div class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="recipe-progress">0</span> / 50</div>
        <div id="recipes-list"></div>
    </div>

    <button class="help-btn" onclick="toggleModal(true)">?</button>

    <div id="help-modal" class="modal" onclick="if(event.target===this) toggleModal(false)">
        <div class="modal-content">
            <div class="modal-title">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –Ω–æ–≤–∏—á–∫–∞</div>
            <div class="guide-item">
                <span class="guide-label">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</span>
                <p class="guide-text">–í—ã–±–∏—Ä–∞–π—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–æ—Ç—ë–ª". –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å —Å–æ—á–µ—Ç–∞–Ω–∏—è–º–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–µ –±–ª—é–¥–∞!</p>
            </div>
            <div class="guide-item">
                <span class="guide-label">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</span>
                <p class="guide-text">–ú–∞–∫—Å–∏–º—É–º –≤ –æ–¥–∏–Ω –∫—Ä–∞—Ñ—Ç –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å 9 —Ä–∞–∑–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤. –ü–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω. –ü–æ–≤—Ç–æ—Ä—è—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –Ω–µ–ª—å–∑—è.</p>
            </div>
            <div class="guide-item">
                <span class="guide-label">–ú–∞–≥–∞–∑–∏–Ω –∏ –¢–∞–π–º–µ—Ä</span>
                <p class="guide-text">–¢–æ–≤–∞—Ä—ã –≤ –ª–∞–≤–∫–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã! –¢–∞–π–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–µ–¥–µ—Ç –Ω–æ–≤–∞—è —Ç–µ–ª–µ–≥–∞ —Å –ø—Ä–∏–ø–∞—Å–∞–º–∏. –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∞—Å—ã –ø—Ä–∏ —ç—Ç–æ–º –∏—Å—á–µ–∑–∞—é—Ç.</p>
            </div>
            <div class="guide-item">
                <span class="guide-label">–ì–¥–µ –≤–∑—è—Ç—å –¥–µ–Ω—å–≥–∏?</span>
                <p class="guide-text">1. –ü—Ä–æ–¥–∞–≤–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –±–ª—é–¥–∞ –≤–æ –≤–∫–ª–∞–¥–∫–µ "–õ–∞–≤–∫–∞".<br>2. –ö–∞–∂–¥—ã–π —á–∞—Å –≤–∞–º –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –±–æ–Ω—É—Å: <b>–£—Ä–æ–≤–µ–Ω—å √ó 25 –º–æ–Ω–µ—Ç</b>.</p>
            </div>
            <div class="guide-item">
                <span class="guide-label">–†–µ–¥–∫–æ—Å—Ç—å</span>
                <p class="guide-text">–ë–ª—é–¥–∞ –±—ã–≤–∞—é—Ç: –û–±—ã—á–Ω—ã–µ, –ù–µ–æ–±—ã—á–Ω—ã–µ, –†–µ–¥–∫–∏–µ, –≠–ø–∏—á–µ—Å–∫–∏–µ –∏ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ. –ß–µ–º –≤—ã—à–µ —Ä–µ–¥–∫–æ—Å—Ç—å, —Ç–µ–º –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ!</p>
            </div>
            <button class="btn-primary" onclick="toggleModal(false)">–ü–æ–Ω—è—Ç–Ω–æ!</button>
        </div>
    </div>

    <div id="toast" class="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <script>
        const ALL_INGREDIENTS = [
            { id: 1, name: '–ú—É–∫–∞', emoji: 'üåæ', lvl: 1, price: 5 },
            { id: 2, name: '–°–æ–ª—å', emoji: 'üßÇ', lvl: 1, price: 3 },
            { id: 3, name: '–í–æ–¥–∞', emoji: 'üíß', lvl: 1, price: 2 },
            { id: 4, name: '–°–∞—Ö–∞—Ä', emoji: 'üçö', lvl: 1, price: 6 },
            { id: 5, name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', emoji: 'ü•î', lvl: 1, price: 8 },
            { id: 6, name: '–¢–æ–º–∞—Ç', emoji: 'üçÖ', lvl: 2, price: 10 },
            { id: 7, name: '–û–≥—É—Ä–µ—Ü', emoji: 'ü•í', lvl: 2, price: 9 },
            { id: 8, name: '–ú–æ—Ä–∫–æ–≤—å', emoji: 'ü•ï', lvl: 2, price: 8 },
            { id: 9, name: '–Ø–π—Ü–æ', emoji: 'ü•ö', lvl: 3, price: 12 },
            { id: 10, name: '–ú–æ–ª–æ–∫–æ', emoji: 'ü•õ', lvl: 3, price: 15 },
            { id: 11, name: '–ú–∞—Å–ª–æ', emoji: 'üßà', lvl: 3, price: 18 },
            { id: 12, name: '–ú—è—Å–æ', emoji: 'ü•©', lvl: 4, price: 30 },
            { id: 13, name: '–ö—É—Ä–∏—Ü–∞', emoji: 'üçó', lvl: 4, price: 25 },
            { id: 14, name: '–†—ã–±–∞', emoji: 'üêü', lvl: 5, price: 28 },
            { id: 15, name: '–†–∏—Å', emoji: 'üçô', lvl: 5, price: 20 },
            { id: 16, name: '–°—ã—Ä', emoji: 'üßÄ', lvl: 6, price: 22 },
            { id: 17, name: '–ì—Ä–∏–±—ã', emoji: 'üçÑ', lvl: 6, price: 19 },
            { id: 18, name: '–õ–∏–º–æ–Ω', emoji: 'üçã', lvl: 7, price: 14 },
            { id: 19, name: '–Ø–±–ª–æ–∫–æ', emoji: 'üçé', lvl: 7, price: 12 },
            { id: 20, name: '–®–æ–∫–æ–ª–∞–¥', emoji: 'üç´', lvl: 8, price: 35 },
            { id: 21, name: '–ú–µ–¥', emoji: 'üçØ', lvl: 8, price: 40 },
            { id: 22, name: '–ö—Ä–µ–≤–µ—Ç–∫–∞', emoji: 'ü¶ê', lvl: 9, price: 45 },
            { id: 23, name: '–ß–∏–ª–∏', emoji: 'üå∂Ô∏è', lvl: 10, price: 20 },
            { id: 24, name: '–¢—Ä—é—Ñ–µ–ª—å', emoji: 'üíé', lvl: 12, price: 150 },
            { id: 25, name: '–ó–æ–ª–æ—Ç–æ–π –ª–∏—Å—Ç', emoji: '‚ú®', lvl: 15, price: 500 }
        ];

        const ALL_RECIPES = [
            // Level 1: Common
            { id: 1, name: '–¢–µ—Å—Ç–æ', result: 'ü´ì', ings: [1, 3], price: 15, rarity: 'common' },
            { id: 2, name: '–°–ª–∞–¥–∫–∞—è –≤–æ–¥–∞', result: 'ü•§', ings: [3, 4], price: 12, rarity: 'common' },
            { id: 3, name: '–í–∞—Ä–µ–Ω—ã–π –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å', result: 'ü•î', ings: [3, 5], price: 18, rarity: 'common' },
            { id: 4, name: '–°–æ–ª–µ–Ω—ã–π —Å–∞—Ö–∞—Ä', result: 'üßÇ', ings: [2, 4], price: 10, rarity: 'common' },
            
            // Level 2: Uncommon
            { id: 5, name: '–•–ª–µ–±', result: 'üçû', ings: [1, 2, 3], price: 25, rarity: 'uncommon' },
            { id: 6, name: '–°–∞–ª–∞—Ç', result: 'ü•ó', ings: [6, 7, 8], price: 35, rarity: 'uncommon' },
            { id: 7, name: '–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ–∫', result: 'üçÖ', ings: [3, 6], price: 22, rarity: 'uncommon' },
            { id: 8, name: '–ú–æ—Ä–∫–æ–≤–Ω—ã–π –ø–∞–ª–æ—á–∫–∏', result: 'ü•ï', ings: [2, 8], price: 20, rarity: 'uncommon' },
            { id: 9, name: '–ö–µ—Ç—á—É–ø', result: 'ü•´', ings: [2, 4, 6], price: 28, rarity: 'uncommon' },
            
            // Level 3: Rare
            { id: 10, name: '–Ø–∏—á–Ω–∏—Ü–∞', result: 'üç≥', ings: [2, 9, 11], price: 45, rarity: 'rare' },
            { id: 11, name: '–ë–ª–∏–Ω—á–∏–∫–∏', result: 'ü•û', ings: [1, 4, 9, 10], price: 55, rarity: 'rare' },
            { id: 12, name: '–û–º–ª–µ—Ç', result: 'üç±', ings: [9, 10, 11], price: 50, rarity: 'rare' },
            { id: 13, name: '–ë–∏—Å–∫–≤–∏—Ç', result: 'ü•Æ', ings: [1, 4, 9], price: 40, rarity: 'rare' },
            { id: 14, name: '–ú–∞—Å–ª–æ —Å —Å–æ–ª—å—é', result: 'üßà', ings: [2, 11], price: 25, rarity: 'rare' },

            // Level 4-5: Epic
            { id: 15, name: '–°—Ç–µ–π–∫', result: 'ü•©', ings: [2, 11, 12], price: 85, rarity: 'epic' },
            { id: 16, name: '–ñ–∞—Ä–µ–Ω–∞—è –∫—É—Ä–∏—Ü–∞', result: 'üçó', ings: [1, 2, 13], price: 75, rarity: 'epic' },
            { id: 17, name: '–°—É—à–∏', result: 'üç£', ings: [14, 15], price: 95, rarity: 'epic' },
            { id: 18, name: '–†—ã–±–Ω—ã–π —Å—É–ø', result: 'üç≤', ings: [3, 12, 14], price: 110, rarity: 'epic' },
            { id: 19, name: '–ë—É—Ä–≥–µ—Ä', result: 'üçî', ings: [1, 6, 12, 16], price: 130, rarity: 'epic' },
            { id: 20, name: '–ü–∏—Ü—Ü–∞', result: 'üçï', ings: [1, 6, 16, 17], price: 140, rarity: 'epic' },
            { id: 21, name: '–ü–ª–æ–≤', result: 'üçõ', ings: [8, 12, 15], price: 120, rarity: 'epic' },
            { id: 22, name: '–ì—Ä–∏–±–Ω–æ–π —Å—É–ø', result: 'ü•£', ings: [3, 10, 17], price: 90, rarity: 'epic' },
            { id: 23, name: '–ú—è—Å–Ω–æ–π –ø–∏—Ä–æ–≥', result: 'ü•ß', ings: [1, 9, 12], price: 115, rarity: 'epic' },
            { id: 24, name: '–†—ã–±–∞ —Å —Ä–∏—Å–æ–º', result: 'üç±', ings: [14, 15, 2], price: 100, rarity: 'epic' },

            // Level 6-10: Legendary & Beyond
            { id: 25, name: '–ß–∏–∑–∫–µ–π–∫', result: 'üç∞', ings: [1, 8, 10, 16], price: 180, rarity: 'legendary' },
            { id: 26, name: '–Ø–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥', result: 'ü•ß', ings: [1, 4, 11, 19], price: 160, rarity: 'legendary' },
            { id: 27, name: '–®–æ–∫–æ–ª–∞–¥–Ω—ã–π —Ç–æ—Ä—Ç', result: 'üéÇ', ings: [1, 4, 10, 20], price: 250, rarity: 'legendary' },
            { id: 28, name: '–ú–µ–¥–æ–≤–∏–∫', result: 'üçØ', ings: [1, 4, 10, 21], price: 270, rarity: 'legendary' },
            { id: 29, name: '–õ–∏–º–æ–Ω–Ω—ã–π —Ç–∞—Ä—Ç', result: 'üçã', ings: [1, 4, 18], price: 150, rarity: 'legendary' },
            { id: 30, name: '–ö—Ä–µ–≤–µ—Ç–∫–∏ –≤ –º–∞—Å–ª–µ', result: 'ü¶ê', ings: [2, 11, 22], price: 220, rarity: 'legendary' },
            { id: 31, name: '–û—Å—Ç—Ä–∞—è –∫—É—Ä–∏—Ü–∞', result: 'üå∂Ô∏è', ings: [13, 23, 2], price: 140, rarity: 'legendary' },
            { id: 32, name: '–ì—Ä–∏–±–Ω–æ–µ —Ñ–æ–Ω–¥—é', result: 'üßÄ', ings: [16, 17, 10], price: 200, rarity: 'legendary' },
            { id: 33, name: '–ú—è—Å–æ —Å —Ç—Ä—é—Ñ–µ–ª–µ–º', result: 'üíé', ings: [12, 24, 2], price: 600, rarity: 'legendary' },
            { id: 34, name: '–ó–æ–ª–æ—Ç–æ–π —Ç–æ—Ä—Ç', result: '‚ú®', ings: [1, 4, 10, 25], price: 1500, rarity: 'legendary' },
            { id: 35, name: '–®–æ–∫–æ–ª–∞–¥–Ω–æ–µ —Ñ–æ–Ω–¥—é', result: 'üç´', ings: [20, 10], price: 180, rarity: 'legendary' },
            { id: 36, name: '–†–∏—Å —Å —Ç—Ä—é—Ñ–µ–ª–µ–º', result: 'üçô', ings: [15, 24], price: 450, rarity: 'legendary' },
            { id: 37, name: '–ú–µ–¥–æ–≤—ã–π —á–∞–π', result: 'üçµ', ings: [3, 21, 18], price: 130, rarity: 'legendary' },
            { id: 38, name: '–û—Å—Ç—Ä–∞—è —Ä—ã–±–∞', result: 'üêü', ings: [14, 23, 2], price: 145, rarity: 'legendary' },
            { id: 39, name: '–¢—Ä—é—Ñ–µ–ª—å–Ω–æ–µ –º–∞—Å–ª–æ', result: 'üßà', ings: [11, 24], price: 350, rarity: 'legendary' },
            { id: 40, name: '–ö—Ä–µ–≤–µ—Ç–æ—á–Ω—ã–π —Å—É–ø', result: 'üçú', ings: [3, 10, 22], price: 240, rarity: 'legendary' },
            { id: 41, name: '–ó–æ–ª–æ—Ç–∞—è –≤–æ–¥–∞', result: 'üíß', ings: [3, 25], price: 800, rarity: 'legendary' },
            { id: 42, name: '–Ø–±–ª–æ–∫–æ –≤ –º–µ–¥—É', result: 'üçé', ings: [19, 21], price: 110, rarity: 'legendary' },
            { id: 43, name: '–°—ã—Ä–Ω–∞—è —Ç–∞—Ä–µ–ª–∫–∞', result: 'üßÄ', ings: [16, 14, 19], price: 230, rarity: 'legendary' },
            { id: 44, name: '–ö—É—Ä–∏—Ü–∞ —Å —è–±–ª–æ–∫–∞–º–∏', result: 'üçó', ings: [13, 19, 2], price: 140, rarity: 'legendary' },
            { id: 45, name: '–ú—è—Å–æ —á–∏–ª–∏', result: 'ü•©', ings: [12, 23], price: 155, rarity: 'legendary' },
            { id: 46, name: '–°–ª–∞–¥–∫–∏–π –ª–∏–º–æ–Ω', result: 'üçã', ings: [18, 4], price: 95, rarity: 'legendary' },
            { id: 47, name: '–®–æ–∫–æ–ª–∞–¥–Ω—ã–π –±–∞—Ç–æ–Ω—á–∏–∫', result: 'üç´', ings: [20, 11, 4], price: 190, rarity: 'legendary' },
            { id: 48, name: '–ú–æ—Ä–∫–æ–≤–Ω—ã–π —Ç–æ—Ä—Ç', result: 'ü•ï', ings: [1, 4, 8, 9], price: 170, rarity: 'legendary' },
            { id: 49, name: '–û–≥—É—Ä–µ—á–Ω—ã–π –ª–∏–º–æ–Ω–∞–¥', result: 'ü•§', ings: [3, 4, 7, 18], price: 110, rarity: 'legendary' },
            { id: 50, name: '–¢—Ä—é—Ñ–µ–ª—å–Ω–∞—è –ø–∏—Ü—Ü–∞', result: 'üçï', ings: [1, 6, 16, 24], price: 850, rarity: 'legendary' }
        ];

        let state = {
            level: 1,
            coins: 100,
            inventory: {},   
            products: {},    
            unlocked: [],    
            cauldron: [],    
            shopItems: [],   
            shopResetTime: 0,
            lastIncomeTime: Date.now()
        };

        const saved = localStorage.getItem('foodcraft_v3');
        if (saved) {
            state = JSON.parse(saved);
        } else {
            ALL_INGREDIENTS.forEach(i => state.inventory[i.id] = 0);
            generateShop();
        }

        function saveState() {
            localStorage.setItem('foodcraft_v3', JSON.stringify(state));
            updateUI();
        }

        function generateShop() {
            const availableIngs = ALL_INGREDIENTS.filter(i => i.lvl <= state.level);
            const shuffled = availableIngs.sort(() => 0.5 - Math.random());
            state.shopItems = shuffled.slice(0, 4).map(i => ({
                id: i.id,
                stock: Math.floor(Math.random() * 6) + 2
            }));
            state.shopResetTime = Date.now() + 15 * 60 * 1000;
            saveState();
        }

        function checkIntervals() {
            const now = Date.now();
            if (now > state.shopResetTime) {
                generateShop();
                showToast('üõí –ü—Ä–∏–µ—Ö–∞–ª–∞ –Ω–æ–≤–∞—è —Ç–µ–ª–µ–≥–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏!');
                if(document.getElementById('tab-shop').classList.contains('active')) renderShop();
            }
            if (now - state.lastIncomeTime >= 3600000) { 
                const reward = state.level * 25;
                state.coins += reward;
                state.lastIncomeTime = now;
                saveState();
                showToast(`üí∏ –î–æ—Ö–æ–¥: +${reward} –º–æ–Ω–µ—Ç!`);
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function updateUI() {
            document.getElementById('ui-level').textContent = state.level;
            document.getElementById('ui-coins').textContent = Math.floor(state.coins);
            document.getElementById('recipe-progress').textContent = state.unlocked.length;
        }

        function toggleModal(show) {
            document.getElementById('help-modal').classList.toggle('show', show);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            document.querySelector(`.nav-tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            if (tab === 'craft') { renderInventory(); renderCauldron(); }
            else if (tab === 'shop') { renderShop(); renderSellGrid(); }
            else if (tab === 'recipes') { renderRecipes(); }
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            ALL_INGREDIENTS.forEach(ing => {
                if (ing.lvl > state.level + 1) return; 
                const count = state.inventory[ing.id] || 0;
                const inCauldron = state.cauldron.includes(ing.id);
                const div = document.createElement('div');
                div.className = `item-card ${count === 0 ? 'locked' : ''} ${inCauldron ? 'selected' : ''}`;
                div.onclick = () => {
                    if (count > 0 && !inCauldron) {
                        if (state.cauldron.length < 9) {
                            state.cauldron.push(ing.id);
                            state.inventory[ing.id]--;
                            saveState(); renderInventory(); renderCauldron();
                        } else showToast('–ö–æ—Ç—ë–ª –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω!');
                    } else if (inCauldron) {
                        state.cauldron = state.cauldron.filter(id => id !== ing.id);
                        state.inventory[ing.id]++;
                        saveState(); renderInventory(); renderCauldron();
                    }
                };
                div.innerHTML = `<div class="item-emoji">${ing.emoji}</div><div class="item-name">${ing.name}</div><div class="item-count ${count===0?'item-zero':''}">${count} —à—Ç</div>`;
                grid.appendChild(div);
            });
        }

        function renderCauldron() {
            const c = document.getElementById('cauldron');
            c.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const slotId = state.cauldron[i];
                const div = document.createElement('div');
                div.className = `c-slot ${slotId ? 'filled' : ''}`;
                if (slotId) {
                    const ing = ALL_INGREDIENTS.find(x => x.id === slotId);
                    div.textContent = ing.emoji;
                    div.onclick = () => {
                        state.cauldron = state.cauldron.filter(id => id !== slotId);
                        state.inventory[slotId]++;
                        saveState(); renderInventory(); renderCauldron();
                    }
                }
                c.appendChild(div);
            }
            document.getElementById('btn-craft').disabled = state.cauldron.length < 2;
        }

        function doCraft() {
            const cauldronIngs = [...state.cauldron].sort();
            let crafted = ALL_RECIPES.find(r => JSON.stringify([...r.ings].sort()) === JSON.stringify(cauldronIngs));
            if (crafted) {
                state.products[crafted.id] = (state.products[crafted.id] || 0) + 1;
                let msg = `‚ú® ${crafted.result} ${crafted.name}!`;
                if (!state.unlocked.includes(crafted.id)) {
                    state.unlocked.push(crafted.id);
                    if (state.level < 15) state.level = Math.floor(state.unlocked.length / 3) + 1;
                    msg += ' üåü –†–µ—Ü–µ–ø—Ç –æ—Ç–∫—Ä—ã—Ç!';
                }
                showToast(msg);
            } else showToast('ü§¢ –≠—Ö, –Ω–µ–≤–∫—É—Å–Ω–æ... –ü—Ä–æ–¥—É–∫—Ç—ã –∏—Å–ø–æ—Ä—á–µ–Ω—ã.');
            state.cauldron = [];
            saveState(); renderCauldron(); renderInventory();
        }

        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            state.shopItems.forEach(item => {
                const ing = ALL_INGREDIENTS.find(i => i.id === item.id);
                const div = document.createElement('div');
                const canBuy = item.stock > 0 && state.coins >= ing.price;
                div.className = `item-card ${!canBuy ? 'locked' : ''}`;
                div.onclick = () => {
                    if (canBuy) {
                        state.coins -= ing.price; item.stock--;
                        state.inventory[ing.id] = (state.inventory[ing.id] || 0) + 1;
                        saveState(); renderShop();
                    } else if (state.coins < ing.price) showToast('ü™ô –ú–∞–ª–æ –º–æ–Ω–µ—Ç!');
                };
                div.innerHTML = `<div class="item-emoji">${ing.emoji}</div><div class="item-name">${ing.name}</div><div class="item-price">ü™ô ${ing.price}</div><div class="item-stock">–ó–∞–ø–∞—Å: ${item.stock}</div>`;
                grid.appendChild(div);
            });
        }

        function renderSellGrid() {
            const grid = document.getElementById('sell-grid'); grid.innerHTML = '';
            let has = false;
            for (const [id, count] of Object.entries(state.products)) {
                if (count > 0) {
                    has = true; const r = ALL_RECIPES.find(x => x.id == id);
                    const div = document.createElement('div'); div.className = 'item-card';
                    div.onclick = () => {
                        state.coins += r.price; state.products[id]--;
                        saveState(); renderSellGrid(); showToast(`ü™ô +${r.price}`);
                    };
                    div.innerHTML = `<div class="rarity-label" style="background:var(--rarity-${r.rarity});color:white">${r.rarity}</div><div class="item-emoji">${r.result}</div><div class="item-name">${r.name}</div><div class="item-count">${count} —à—Ç</div><div class="item-price">ü™ô ${r.price}</div>`;
                    grid.appendChild(div);
                }
            }
            if(!has) grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;color:var(--hint)">–ù–µ—Ç –±–ª—é–¥ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</div>';
        }

        const RARITY_NAMES = { common: '–û–±—ã—á–Ω–æ–µ', uncommon: '–ù–µ–æ–±—ã—á–Ω–æ–µ', rare: '–†–µ–¥–∫–æ–µ', epic: '–≠–ø–∏—á–µ—Å–∫–æ–µ', legendary: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ' };

        function renderRecipes() {
            const list = document.getElementById('recipes-list'); list.innerHTML = '';
            ALL_RECIPES.forEach(r => {
                const is = state.unlocked.includes(r.id);
                const div = document.createElement('div'); 
                div.className = `recipe-row ${r.rarity}`;
                if (is) {
                    const txt = r.ings.map(id => ALL_INGREDIENTS.find(i => i.id === id).emoji).join(' + ');
                    div.innerHTML = `<div class="recipe-result">${r.result}</div><div class="recipe-info"><div class="rarity-label" style="background:var(--rarity-${r.rarity});color:white">${RARITY_NAMES[r.rarity]}</div><div class="recipe-name">${r.name}</div><div class="recipe-ings">${txt}</div></div><div class="item-price">ü™ô ${r.price}</div>`;
                } else {
                    const hintIng = ALL_INGREDIENTS.find(i => i.id === r.ings[0]);
                    div.innerHTML = `<div class="recipe-result" style="opacity:0.2">‚ùì</div><div class="recipe-info"><div class="rarity-label" style="background:var(--rarity-${r.rarity});color:white">${RARITY_NAMES[r.rarity]}</div><div class="recipe-name">–°–µ–∫—Ä–µ—Ç–Ω–æ–µ –±–ª—é–¥–æ</div><div class="recipe-hint">–ù—É–∂–Ω–æ ${r.ings.length} –∏–Ω–≥—Ä. –û–¥–∏–Ω –∏–∑ –Ω–∏—Ö: ${hintIng.name}</div></div>`;
                }
                list.appendChild(div);
            });
        }

        setInterval(() => {
            checkIntervals();
            const diff = Math.max(0, state.shopResetTime - Date.now());
            const min = Math.floor(diff / 60000); const sec = Math.floor((diff % 60000) / 1000);
            const el = document.getElementById('shop-timer');
            if(el) el.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
        }, 1000);

        updateUI(); switchTab('craft');
    </script>
</body>
</html>
