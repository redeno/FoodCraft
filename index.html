<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Craft - Roblox Mini</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial; 
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%); 
            min-height: 100vh; 
            padding: 10px;
        }
        .header { 
            position: fixed; top: 10px; right: 10px; left: 10px; 
            background: rgba(255,255,255,0.95); 
            padding: 15px; border-radius: 20px; 
            font-size: 20px; font-weight: bold; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .tabs { 
            display: flex; gap: 10px; margin: 80px 10px 20px; 
            flex-wrap: wrap;
        }
        button { 
            background: linear-gradient(45deg, #4CAF50, #45a049); 
            color: white; border: none; 
            padding: 15px 25px; border-radius: 12px; 
            cursor: pointer; font-size: 16px; font-weight: 600;
            transition: all 0.3s; box-shadow: 0 4px 15px rgba(76,175,80,0.3);
        }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76,175,80,0.4); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .tab { display: none; padding: 20px; }
        .tab.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .item { 
            background: rgba(255,255,255,0.95); border-radius: 16px; 
            padding: 20px 10px; text-align: center; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.3s; cursor: pointer;
        }
        .item:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 12px 35px rgba(0,0,0,0.2); }
        .price { color: #4CAF50; font-weight: bold; font-size: 18px; }
        .count { color: #2196F3; font-weight: bold; font-size: 20px; }
        #username { 
            position: fixed; bottom: 20px; left: 20px; 
            padding: 15px; border-radius: 12px; border: 2px solid #ddd; 
            font-size: 16px; width: 250px;
        }
        .locked { opacity: 0.5; background: #f0f0f0; position: relative; }
        .locked::after { content: "üîí"; font-size: 24px; display: block; }
        .empty { font-style: italic; color: #666; text-align: center; grid-column: 1/-1; padding: 40px; }
    </style>
</head>
<body>
    <div class="header">
        <span>üç≥ Food Craft</span>
        <span id="status">üëã –í–≤–µ–¥–∏ –Ω–∏–∫ –∏ –Ω–∞—á–Ω–∏!</span>
        <span id="coins" style="display:none">üí∞ <span id="coin-count">100</span> | –£—Ä. <span id="level-count">1</span></span>
    </div>

    <div class="tabs" id="tabs" style="display:none">
        <button type="button">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        <button type="button">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
        <button type="button">üî® –ö—Ä–∞—Ñ—Ç</button>
        <button type="button">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        <button type="button" id="sellBtn" disabled>üíµ –ü—Ä–æ–¥–∞—Ç—å</button>
    </div>

    <div id="inventory" class="tab active">
        <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
        <div id="inv-grid" class="grid"><div class="empty">–ü—É—Å—Ç–æ! –ö—É–ø–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ üåæ</div></div>
    </div>

    <div id="shop" class="tab">
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω (<span id="shop-timer">30:00</span>)</h2>
        <div id="shop-grid" class="grid"></div>
    </div>

    <div id="craft" class="tab">
        <h2>üî® –ö—Ä–∞—Ñ—Ç –µ–¥—ã</h2>
        <div id="craft-grid" class="grid"></div>
    </div>

    <div id="achievements" class="tab">
        <h2>üèÜ –ì–æ—Ç–æ–≤–∞—è –µ–¥–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∂–∏)</h2>
        <div id="ach-grid" class="grid"></div>
    </div>

    <input type="text" id="username" placeholder="–í–≤–µ–¥–∏ –Ω–∏–∫..." value="Player">
    <button onclick="initUser()" style="position:fixed; bottom:20px; left:290px;">üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –ë–ï–ó –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        window.gameData = {
            userId: null,
            inventory: {},
            shopItems: [],
            recipes: [
                {id:1, name:'Bread', emoji:'üçû', ingredients:[{id:1,count:2},{id:2,count:1}], price:21, req_level:1, unlocked_by_default:true},
                {id:2, name:'Cake', emoji:'üéÇ', ingredients:[{id:1,count:2},{id:2,count:2},{id:3,count:2},{id:4,count:1}], price:41, req_level:2},
                {id:3, name:'Carrot Cake', emoji:'ü•ïüéÇ', ingredients:[{id:1,count:1},{id:4,count:1},{id:3,count:1},{id:2,count:1},{id:6,count:1}], price:41, req_level:3}
            ],
            ingredients: [
                {id:1, name:'Flour', price:5, emoji:'üåæ'},
                {id:2, name:'Sugar', price:5, emoji:'üçö'},
                {id:3, name:'Egg', price:10, emoji:'ü•ö'},
                {id:4, name:'Milk', price:10, emoji:'ü•õ'},
                {id:5, name:'Potato', price:8, emoji:'ü•î'},
                {id:6, name:'Carrot', price:8, emoji:'ü•ï'},
                {id:7, name:'Tomato', price:7, emoji:'üçÖ'}
            ],
            unlockedIngredients: [1],
            unlockedRecipes: [],
            userLevel: 1,
            userCoins: 100,
            shopRefresh: Date.now() + 30*60*1000
        };

        // –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ
        function initUser() {
            gameData.userId = 'player_' + Date.now();
            gameData.inventory = {};
            gameData.unlockedIngredients = [1];
            gameData.unlockedRecipes = [];
            
            document.getElementById('status').style.display = 'none';
            document.getElementById('coins').style.display = 'inline';
            document.getElementById('tabs').style.display = 'flex';
            document.getElementById('username').style.display = 'none';
            document.querySelector('button[onclick="initUser()"]').style.display = 'none';
            
            renderAll();
            updateShopTimer();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            if (tabId === 'shop') updateShop();
            if (tabId === 'craft') renderCraft();
        }

        function renderInventory() {
            const grid = document.getElementById('inv-grid');
            grid.innerHTML = '';
            let hasItems = false;
            
            gameData.ingredients.forEach(ing => {
                const count = gameData.inventory[ing.id] || 0;
                if (count > 0 && gameData.unlockedIngredients.includes(ing.id)) {
                    hasItems = true;
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `${ing.emoji}<br><small>${ing.name}</small><br><span class="count">√ó${count}</span>`;
                    grid.appendChild(div);
                }
            });
            
            if (!hasItems) {
                grid.innerHTML = '<div class="empty">–ü—É—Å—Ç–æ! –ö—É–ø–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ üåæ</div>';
            }
        }

        function updateShop() {
            const availableIngs = gameData.ingredients.filter(ing => gameData.unlockedIngredients.includes(ing.id));
            gameData.shopItems = availableIngs.map(ing => ({
                ...ing,
                qty: Math.floor(Math.random() * 3) + 1
            }));
            
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            
            gameData.shopItems.forEach(item => {
                const totalPrice = item.price * item.qty;
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    ${item.emoji}<br><small>${ing.name}</small><br>
                    √ó${item.qty} –∑–∞ <span class="price">$${totalPrice}</span><br>
                    <button onclick="buyItem(${item.id}, ${item.qty}, ${totalPrice})" 
                            ${gameData.userCoins < totalPrice ? 'disabled' : ''}>
                        ${gameData.userCoins < totalPrice ? '–ù–µ—Ç üí∞' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                `;
                grid.appendChild(div);
            });
        }

        function updateShopTimer() {
            const diff = Math.max(0, gameData.shopRefresh - Date.now());
            const min = Math.floor(diff / 60000);
            const sec = Math.floor((diff % 60000) / 1000);
            document.getElementById('shop-timer').textContent = `${min}:${sec.toString().padStart(2, '0')}`;
            setTimeout(updateShopTimer, 1000);
        }

        function buyItem(ingId, qty, totalPrice) {
            if (gameData.userCoins < totalPrice) {
                alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }
            
            gameData.userCoins -= totalPrice;
            gameData.inventory[ingId] = (gameData.inventory[ingId] || 0) + qty;
            
            document.getElementById('coin-count').textContent = gameData.userCoins;
            renderInventory();
            updateShop();
        }

        function tryCraft(recipeId) {
            const recipe = gameData.recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            if (recipe.req_level > gameData.userLevel) {
                alert(`üîí –ù—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å ${recipe.req_level}!`);
                return;
            }
            
            const ingAvailable = recipe.ingredients.every(ing => gameData.unlockedIngredients.includes(ing.id));
            if (!ingAvailable) {
                alert('üîí –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç!');
                return;
            }
            
            let canCraft = true;
            recipe.ingredients.forEach(ing => {
                const have = gameData.inventory[ing.id] || 0;
                if (have < ing.count) canCraft = false;
            });
            
            if (!canCraft) {
                alert('‚ùå –ú–∞–ª–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!');
                return;
            }
            
            // –ö–†–ê–§–¢
            recipe.ingredients.forEach(ing => {
                gameData.inventory[ing.id] = (gameData.inventory[ing.id] || 0) - ing.count;
            });
            
            // –®–∞–Ω—Å –Ω–æ–≤–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
            if (Math.random() < 0.3 && gameData.unlockedIngredients.length < gameData.ingredients.length) {
                const newIngId = gameData.ingredients[Math.floor(Math.random() * gameData.ingredients.length)].id;
                if (!gameData.unlockedIngredients.includes(newIngId)) {
                    gameData.unlockedIngredients.push(newIngId);
                    alert(`‚ú® –ù–æ–≤—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç: ${gameData.ingredients.find(i => i.id === newIngId)?.name}!`);
                }
            }
            
            gameData.unlockedRecipes.push(recipe.id);
            document.getElementById('sellBtn').disabled = false;
            
            alert(`‚úÖ –°–∫—Ä–∞—Ñ—á–µ–Ω–æ: ${recipe.emoji} ${recipe.name}!`);
            renderAll();
        }

        function sellAll() {
            if (gameData.unlockedRecipes.length === 0) {
                alert('‚ùå –ù–µ—Ç –µ–¥—ã –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏!');
                return;
            }
            
            let totalSell = 0;
            gameData.unlockedRecipes.forEach(rid => {
                const recipe = gameData.recipes.find(r => r.id === rid);
                totalSell += recipe ? recipe.price : 0;
            });
            
            gameData.userCoins += totalSell;
            gameData.userLevel = 1 + Math.floor(gameData.unlockedRecipes.length / 3);
            gameData.unlockedRecipes = [];
            
            document.getElementById('coin-count').textContent = gameData.userCoins;
            document.getElementById('level-count').textContent = gameData.userLevel;
            document.getElementById('sellBtn').disabled = true;
            
            alert(`üí∞ –ü—Ä–æ–¥–∞–Ω–æ –Ω–∞ ${totalSell} –º–æ–Ω–µ—Ç! –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${gameData.userLevel}`);
            renderAll();
        }

        function renderCraft() {
            const grid = document.getElementById('craft-grid');
            grid.innerHTML = '';
            
            gameData.recipes.forEach(recipe => {
                const levelOk = recipe.req_level <= gameData.userLevel;
                const ingOk = recipe.ingredients.every(ing => gameData.unlockedIngredients.includes(ing.id));
                
                const div = document.createElement('div');
                div.className = `item ${!levelOk || !ingOk ? 'locked' : ''}`;
                div.innerHTML = `
                    ${recipe.emoji}<br><small>${recipe.name}</small><br>
                    –£—Ä.${recipe.req_level}<br>
                    ${levelOk && ingOk ? `<button onclick="tryCraft(${recipe.id})">–ö—Ä–∞—Ñ—Ç–∏—Ç—å</button>` : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'}
                `;
                grid.appendChild(div);
            });
        }

        function renderAchievements() {
            const grid = document.getElementById('ach-grid');
            grid.innerHTML = '';
            
            if (gameData.unlockedRecipes.length === 0) {
                grid.innerHTML = '<div class="empty">–°–∫—Ä–∞—Ñ—Ç–∏ –µ–¥—É –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏!</div>';
                return;
            }
            
            gameData.unlockedRecipes.forEach(rid => {
                const recipe = gameData.recipes.find(r => r.id === rid);
                if (recipe) {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `${recipe.emoji} ${recipe.name}`;
                    grid.appendChild(div);
                }
            });
        }

        function renderAll() {
            renderInventory();
            renderCraft();
            renderAchievements();
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.tabs button')[0].onclick = () => switchTab('inventory');
            document.querySelectorAll('.tabs button')[1].onclick = () => switchTab('shop');
            document.querySelectorAll('.tabs button')[2].onclick = () => switchTab('craft');
            document.querySelectorAll('.tabs button')[3].onclick = () => switchTab('achievements');
        });

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.initUser = initUser;
        window.switchTab = switchTab;
        window.buyItem = buyItem;
        window.tryCraft = tryCraft;
        window.sellAll = sellAll;
        window.renderAll = renderAll;
    </script>
</body>
</html>
